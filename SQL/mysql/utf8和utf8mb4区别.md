## 字符编码

### ASCII码
计算机最底层用来表示信息的是二进制数。也就是`0`和`1`。一个0或1代表一个位(比特 bit)。八个二进制符`00000000`-`11111111`可以表示256个状态，八个位组成1个字节(byte)，这么多状态足够美国人使用了，于是推出了`ASCII`码标准。

### 非ASCII码
英文只要26个字母就能组合成任意单词，但是其他国家的语言就不行了。比如说中文，每个中文都是不同的字，汉语大字典就有`60370`个字，256种状态明显是不够用的。于是用两个字节表示一个状态的`GB2312`编码，是简体中文最常见的编码。理论上`256*256=65536`个符号，也是暂时足够使用的。

### Unicode
每个语言都拥有属于自己的一套编码，在打开文件的时候必须要知道它的编码方式，不然会出现乱码。这不是很糟糕？于是出了一套`Unicode`。现在的规模可以容纳100多万个符号。

`Unicode`强制规定一个符号用三个或者四个字符表示，假如是英文这是非常浪费的。

### UTF-8
`UTF-8`是`Unicode`的一种实现方式，其他实现方式还有`UTF-16`,`UTF-32`。

`UTF-8`最大的特点是它是一种变长的编码方式，用1~4个字节表示一个符号，根据不同的符号变化字节长度。

UTF-8 的编码规则很简单，只有二条：

1. 对于单字节的符号，字节的第一位设为0，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。

2. 对于n字节的符号（n > 1），第一个字节的前n位都设为1，第n + 1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。

```
Unicode符号范围     |        UTF-8编码方式
(十六进制)          |              （二进制）
----------------------+---------------------------------------------
0000 0000-0000 007F | 0xxxxxxx
0000 0080-0000 07FF | 110xxxxx 10xxxxxx
0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
```

### utf8和utf8mb4
`mysql`当初设计`utf8`的时候，是用1~3个字节来表示一个字符。有一部分符号还是无法表示。而`utf8mb4`的意思是用1~4个字节表示一个字符。mb4即 most bytes 4。简单说 `utf8mb4` 是 `utf8` 的超集并完全兼容`utf8`，能够用四个字节存储更多的字符。

### utf8mb4_unicode_ci 与 utf8mb4_general_ci 如何选择

- 准确性        
`utf8mb4_unicode_ci` 是基于标准的Unicode来排序和比较，能够在各种语言之间精确排序

`utf8mb4_general_ci` 没有实现Unicode排序规则，在遇到某些特殊语言或字符是，排序结果可能不是所期望的。

但是在绝大多数情况下，这种特殊字符的顺序一定要那么精确吗。比如`Unicode`把`ß`、`Œ`当成`ss`和`OE`来看；而`general`会把它们当成`s`、`e`，再如`ÀÁÅåāă`各自都与 `A` 相等。

- 性能        
`utf8mb4_general_ci` 在比较和排序的时候更快

`utf8mb4_unicode_ci` 在特殊情况下，Unicode排序规则为了能够处理特殊字符的情况，实现了略微复杂的排序算法。

但是在绝大多数情况下，不会发生此类复杂比较。general理论上比Unicode可能快些，但相比现在的CPU来说，它远远不足以成为考虑性能的因素，索引涉及、SQL设计才是。 我个人推荐是 utf8mb4_unicode_ci，将来 8.0 里也极有可能使用变为默认的规则。相比选择哪一种collation，使用者应该更关心字符集与排序规则在db里要统一就好。

